var P=Object.defineProperty;var H=(r,e,t)=>e in r?P(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(H(r,typeof e!="symbol"?e+"":e,t),t);import{G as $,ao as D,ap as L}from"./element-plus.2a9868ae.js";import{M as b,r as m,o as V,f as B,a9 as k,h,T as f,U as w,u as d,Y as T,R as A,i as x,ao as N,j as R,k as _,V as E,$ as S,F as j,Z as g}from"./base-module.ee10d16b.js";class C{constructor(e,t){a(this,"input");a(this,"callback");a(this,"type");a(this,"symbol");a(this,"pattern");a(this,"cursor");a(this,"isInit");a(this,"lock");a(this,"value");a(this,"selectionStart");a(this,"selectionEnd");this.input=e;let s={type:"password",symbol:"*",callback:()=>{},pattern:/([\u4e00-\u9fa5])/g},{type:l,symbol:n,callback:o,pattern:i}={...s,...t};if(!this.input||this.input.tagName.toLowerCase()!="input"||this.input.type==="password")throw new Error("\u8BF7\u4F20\u4E00\u4E2Atype\u4E3Atext\u7684input\u7684id\uFF01");return this.input.valueProxy="",this.callback=o,this.type=l,this.symbol=n,this.pattern=i,this.cursor=0,this.isInit=!1,Object.defineProperty(this,"value",{get(){return this.input.valueProxy}}),this.init(),this}init(){this._inputHandler(!0),this._preventDefaultEvent(),this._bindEvent(),this.isInit=!0}_preventDefaultEvent(e){let t=this;function s(){var i=e||window.event;i.preventDefault()}function l(i){return i.button===0&&t.selectionStart!=t.selectionEnd&&(t.selectionStart=t.selectionEnd=t.value.length),!1}function n(i){return i.preventDefault(),t.warn("_dragleaveHandler"),t.input.removeAttribute("readonly"),!1}function o(i){return i.preventDefault(),t.warn("_dragenterhandlder"),t.input.setAttribute("readonly",!0),!1}this.input.addEventListener("copy",s),this.input.addEventListener("cut",s),this.input.addEventListener("dragenter",o),this.input.addEventListener("dragleave",n),this.input.addEventListener("mousedown",l)}_bindEvent(){this.input.addEventListener("compositionstart",()=>{this.lock=!0,this.warn("start")}),this.input.addEventListener("compositionend",()=>{this.lock=!1,this.warn("end"),this._inputHandler()}),this.input.addEventListener("input",this._inputHandler.bind(this)),this.input.addEventListener("propertychange",this._inputHandler.bind(this))}_inputHandler(e){this.lock||(this.isInit?this.warn("input"):this.warn("init"),this.type==="password"?this._passwordHandler():this._textHandler(),this._showValue(),this._setCursor(),e!==!0&&typeof this.callback=="function"&&this.callback())}_passwordHandler(){var e=this,t=this._filterCn(this.input.value).split(""),s=this.input.valueProxy.split(""),l=t.length-s.length,n=this.input.selectionStart,o=n-this.input.value.split("").length+t.length;if(l>0){var i=t.join("").replace(new RegExp("\\"+e.symbol,"g"),"").split(""),c=t.length-n>0?s.slice(-(t.length-n)):[];s=[].concat(s.slice(0,n-i.length),i,c)}l<0&&s.splice(n,Math.abs(l)),t.forEach(function(p,u){p!=e.symbol&&(s[u]=p)}),this.input.valueProxy=s.join(""),this.cursor=o}_filterCn(e,t){if(!e)return e;var s=this.pattern;return t=t||"",e.replace(s,t)}_textHandler(){this.input.valueProxy=this._filterCn(this.input.value),this.cursor=this.input.selectionStart-this.input.value.split("").length+this.input.valueProxy.split("").length}async _showValue(){var e="";this.type==="password"?this.value.split("").forEach(t=>{e+=this.symbol}):e=this.value,this.input.value=e,this.$nextTick(()=>{this.input.value=e})}$nextTick(e){if(e&&typeof e=="function")requestAnimationFrame?requestAnimationFrame(e):Promise?Promise.resolve().then(()=>{e()}):setTimeout(()=>{e()});else return Promise.resolve()}_setCursor(){this.input.selectionStart=this.cursor,this.input.selectionEnd=this.cursor}warn(e){console.log(e)}$setValue(e){e&&(this.input.value=e),this._inputHandler()}$changeType(e){this.type=e,this.$setValue(this.value)}}const I=b({__name:"input-password",props:{modelValue:null,showPassword:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(r,{emit:e}){const t=r;let s=m(""),l=m();V(()=>{o()});let n="";const o=()=>{let u=l.value.ref;n=new C(u,{symbol:"\u2022",callback:()=>{e("update:modelValue",n.value)}}),n.$setValue(t.modelValue)};let i=m("password"),c=B(()=>i.value=="password");const p=u=>{i.value=u,n==null||n.$changeType(u)};return(u,v)=>{const F=k("el-input");return h(),f(F,A({modelValue:d(s),"onUpdate:modelValue":v[2]||(v[2]=y=>x(s)?s.value=y:s=y),type:"text",ref_key:"inputRef",ref:l},u.$attrs),{suffix:w(()=>[r.showPassword?(h(),f(d($),{key:0},{default:w(()=>[d(c)?(h(),f(d(L),{key:1,onClick:v[1]||(v[1]=y=>p("text"))})):(h(),f(d(D),{key:0,onClick:v[0]||(v[0]=y=>p("password"))}))]),_:1})):T("",!0)]),_:1},16,["modelValue"])}}}),q=_("div",null,"\u539F\u751Finput \u8BF7\u4F7F\u7528:modelValue",-1),M=["modelValue"],U=g("\u83B7\u53D6\u503C"),G=_("div",null,[_("br"),g("\u57FA\u4E8Eelement-plus el-input\uFF0C \u5C01\u88C5\u5185\u90E8\u9700\u4F7F\u7528v-model")],-1),O=g("\u83B7\u53D6\u503C2"),W=_("br",null,null,-1),J=b({__name:"index",setup(r){let e=m("init"),t="";V(()=>{let o=document.querySelector("#demo");t=new C(o,{symbol:"\u2022",callback:()=>{e.value=t.value}}),t.$setValue(e.value)});const s=()=>{console.log(111,t.value)};let l=m("sss");const n=()=>{console.log(222,l.value)};return(o,i)=>{const c=k("el-button"),p=N("permission");return h(),R(j,null,[q,_("input",{id:"demo",type:"text",modelValue:d(e)},null,8,M),E((h(),f(c,{onClick:s},{default:w(()=>[U]),_:1})),[[p,["sys:btn","sys:no"]]]),G,S(I,{showPassword:"",modelValue:d(l),"onUpdate:modelValue":i[0]||(i[0]=u=>x(l)?l.value=u:l=u)},null,8,["modelValue"]),E((h(),f(c,{onClick:n},{default:w(()=>[O]),_:1})),[[p,["sys:btn","sys:no"]]]),W],64)}}});export{J as default};
